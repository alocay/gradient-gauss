var freqMin = 7000;
var powerMin = -140;
var freqMax = freqMin + 2943;
var powerMax = -50;
var colors = [[255, 0, 0], [255, 165, 0], [255, 191, 0], [31,117,254], [138,43,226]].reverse();
var width = 1024;
var height = 768;
var step = 1;
var powers = [256,0,-256,-1,511,0,0,0,1536,1,0,11748,8508,17243,16708,16724,16731,17729,16705,17473,12079,12079,16687,16721,16705,16705,16705,16705,16720,16721,16705,18761,16713,16705,29000,13881,13160,28272,29797,13924,13178,14193,29029,13940,13156,19570,28773,13881,13163,27250,28517,13940,13158,19570,29029,13902,13111,21618,29285,13940,13177,29297,29541,13881,13178,28273,30565,13902,13103,28274,30309,13881,13171,17522,30565,14196,13121,20595,30053,13940,13103,17523,30821,13940,13106,13171,30309,13881,13111,30323,30053,14180,13139,28275,30821,14158,13127,28275,12645,14158,13126,30323,31077,14158,13138,25203,12901,14196,13130,13172,13413,14196,13131,30323,31333,14180,13161,28277,13157,14196,13160,18549,12645,14196,13167,20597,12645,14137,13166,13173,14181,14137,13109,22645,14181,14158,13171,19574,14437,14137,13178,19574,13925,13369,13126,20599,16998,12110,13113,21622,16997,14414,13128,18551,17510,14436,13138,14127,18021,14452,13129,12151,18278,14436,13142,17528,17254,14436,13139,17529,19302,14393,13166,27257,19302,14452,13167,29305,20070,14414,13166,25210,19302,14452,13175,27258,20582,14670,13129,22576,20070,14708,13130,28282,21094,14670,13130,12154,20838,14708,13131,27185,22374,14670,13160,12081,23142,14670,13163,30258,22630,14692,13167,20530,25446,14649,13163,28210,24934,14670,13170,22580,26214,11124,13127,14131,26982,11108,13129,28212,27238,11124,13130,17461,28262,11086,13156,22582,28006,11108,13165,31286,29286,11108,13108,12086,28774,11065,13172,12087,31078,11086,13105,26168,12390,11065,13099,26169,31334,12132,13159,19499,13158,12089,13142,27179,13158,12148,13178,21551,14694,12148,13178,12079,14694,12132,13104,25207,16743,17509,13103,19575,16999,16741,13384,19523,18535,16719,13397,29250,19303,16683,13412,26180,19303,16741,13363,31300,20839,16975,13380,18501,21095,16939,13378,27205,21863,16975,13387,27206,21863,16997,13427,28231,25447,17013,13361,14151,25703,17013,13369,26185,25447,17195,13381,18506,26983,17195,13400,25161,28519,17231,13415,22603,28775,17269,13430,17483,29799,17231,13420,12107,29287,17195,13432,26189,30567,17525,13391,17485,31335,17509,13412,14157,13159,17525,13397,27214,13415,17509,13428,27215,11111,17487,13427,21584,16999,18475,13365,30288,17511,17765,13382,25170,17768,17781,13402,26194,18536,17765,13422,14162,19048,17781,13422,31316,19816,17707,13359,20565,20840,17781,13369,18518,22120,18021,13394,22614,22632,18021,13417,20567,24936,17963,13423,17495,25192,18021,13364,28248,26216,18277,13379,21593,25960,18293,13379,12121,26472,18277,13402,30297,28008,18277,13418,25178,29032,18293,13414,14177,28520,18277,13361,27234,29544,18293,13432,19555,30056,18549,13387,25187,30824,18475,13396,28259,30824,18475,13396,17509,12648,18511,13420,26213,13416,18511,13422,25189,13672,18549,13425,18534,12136,18475,13367,26214,17000,19557,13355,26193,17001,18805,13394,12135,18281,18789,13410,31336,18025,18789,13398,20585,19305,18789,13419,12137,19049,18767,13432,12137,19817,18731,13425,26218,20073,18767,13367,26218,20585,18987,13384,30315,21353,19045,13395,17516,21609,18987,13394,25196,22377,19061,13409,14188,23145,18987,13401,29292,24937,19023,13414,28269,23145,19023,13361,20590,24937,19045,13432,13165,25705,19301,13379,30318,26729,19045,13369,20591,26729,19243,13383,13167,26985,19279,13397,25199,27753,19279,13391,28271,27241,19301,13410,29296,27497,19317,13399,21617,28009,19317,13410,21617,28521,19301,13426,13169,28265,19317,13416,30321,29033,19317,13425,29297,29801,19279,13426,29298,29289,19317,13362,12145,29289,19243,13430,17522,30569,19279,13368,22642,30825,19557,13382,21619,30569,19301,13365,31346,30313,19535,13389,12146,30569,19535,13377,30323,31337,19573,13386,28275,31337,19573,13392,31347,31081,19557,13383,17524,12649,19557,13385,30323,31081,19557,13401,31347,12393,19499,13388,14195,12905,19573,13396,26228,12649,19573,13397,13171,31337,19499,13398,14195,12649,19557,13396,21620,12393,19535,13401,14195,12393,19573,13412,27252,13417,19557,13412,31348,13161,19499,13414,12148,13161,19573,13401,21621,13161,19499,13413,27252,13673,19573,13414,25205,13673,19573,13409,18549,13929,19535,13409,26229,13161,19573,13414,29300,13161,19573,13420,20597,12905,19499,13418,12148,12905,19557,13420,17525,12905,19535,13422,20597,13673,19499,13413,27253,12905,19499,13402,14196,13161,19535,13418,26228,13929,19535,13416,26229,13417,19535,13410,14196,13161,19499,13411,30324,12905,19499,13411,26229,12905,19573,13402,20597,13673,19573,13411,14196,13161,19557,13413,20597,13417,19573,13421,18549,12905,19499,13401,25205,13417,19499,13420,28276,13417,19557,13409,25205,12905,19499,13415,13172,13673,19573,13419,17525,12905,19557,13419,18549,13161,19573,13422,21621,13673,19557,13421,13172,13161,19557,13414,26229,12905,19557,13424,13172,13161,19573,13414,21621,13161,19573,13413,31348,13417,19499,13421,18549,12905,19573,13419,29300,12905,19573,13424,21621,13161,19499,13401,19573,13929,19535,13412,21621,12905,19499,13412,28277,13929,19535,13415,13172,13417,19573,13414,12148,13161,19535,13416,31348,13417,19573,13422,29300,13417,19499,13416,12148,13161,19557,13416,28277,12905,19557,13411,31348,13417,19499,13419,26229,13673,19535,13423,17525,13161,19499,13410,22645,13417,19499,13411,30324,13673,19573,13415,27253,13929,19573,13409,17525,12905,19499,13423,31348,13929,19535,13418,30324,13417,19499,13422,19573,13161,19535,13419,26229,13673,19573,13410,29300,13673,19573,13413,25205,13417,19535,13424,18549,13929,19573,13423,17525,13417,19573,13424,20597,13929,19557,13422,28276,13417,19557,13413,17525,13417,19573,13424,14196,12905,19573,13420,29300,13673,19557,13409,29300,13929,19535,13411,18549,13929,19535,13422,30324,12905,19573,13425,30324,12905,19499,13418,31348,13929,19557,13410,28276,13673,19573,13415,21621,13417,19573,13419,29301,13417,19557,13420,12148,13417,19535,13412,31348,13673,19573,13420,20597,13673,19557,13421,27253,13417,19535,13410,22645,13929,19557,13419,30324,13417,19557,13423,27253,13929,19535,13414,25205,13161,19557,13419,26229,13161,19573,13413,14196,13417,19535,13410,17525,12905,19573,13415,19573,12905,19573,13416,20597,13929,19557,13414,14196,13417,19573,13415,26229,13161,19573,13416,28276,13161,19499,13423,25205,13417,19499,13409,26229,12905,19499,13418,14196,13673,19535,13411,20597,13417,19535,13416,17525,13161,19573,13413,20597,13417,19557,13414,22645,13161,19535,13422,31348,13417,19557,13418,19573,13417,19573,13414,29301,13929,19557,13424,30324,13673,19573,13424,17525,13417,19573,13422,29300,13673,19535,13425,26229,13161,19535,13416,14196,12905,19557,13417,27253,13929,19535,13412,29300,13161,19535,13423,30324,13161,19573,13411,28276,13417,19499,13409,18549,13161,19573,13418,13172,13161,19499,13420,13172,13417,19557,13419,19573,13929,19573,13421,18549,13417,19573,13422,12148,13929,19557,13425,12148,13929,19557,13416,28276,13673,19535,13419,30324,13929,19535,13420,29300,13929,19573,13416,25205,13417,19535,13425,25205,13417,19499,13414,12148,13417,19573,13423,25205,12905,19557,13418,28277,13161,19499,13423,18549,13417,19499,13420,28276,13673,19499,13414,31348,13673,19535,13419,20597,13417,19557,13419,28277,13161,19535,13416,29301,13161,19535,13416,30324,13673,19573,13418,25205,13673,19557,13424,19573,13929,19573,13415,30324,13673,19535,13423,28277,12905,19499,13412,25205,13673,19535,13413,29300,12905,19573,13412,30324,13417,19573,13421,12148,13161,19535,13411,21621,13417,19557,13414,17525,13673,19573,13423,29300,13673,19573,13418,14196,13673,19557,13423,25205,13417,19573,13422,28277,12905,19499,13402,25205,13673,19557,13414,17525,12905,19499,13418,30324,13929,19557,13410,13172,12905,19557,13412,26229,13417,19557,13417,25205,13929,19535,13417,29300,13673,19557,13423,28276,13673,19499,13414,22645,13417,19557,13424,17525,13161,19573,13418,17525,13161,19535,13416,25205,13417,19573,13416,26229,13161,19557,13413,26229,13161,19573,13422,25205,13673,19499,13421,12148,13417,19573,13413,12148,12905,19557,13419,13172,13929,19535,13415,31348,13673,19573,13423,29301,13673,19573,13420,21621,13673,19557,13419,19573,13673,19499,13423,26229,12905,19573,13424,29300,13929,19557,13418,31348,13161,19573,13415,28276,13161,19557,13425,20597,13161,19499,13424,21621,12905,19573,13412,28277,13161,19535,13413,28276,13417,19499,13422,21621,13929,19535,13417,21621,12905,19499,13418,31348,13161,19557,13402,27253,13417,19573,13416,12148,13161,19557,13410,29300,12905,19573,13418,28276,13161,19535,13416,27253,13417,19535,13415,25205,12905,19557,13419,17525,13417,19499,13420,20597,13673,19573,13416,30324,13417,19535,13409,29300,13417,19499,13410,26229,13673,19499,13402,29301,13673,19573,13422,18549,13161,19557,13422,31348,13929,19535,13410,21621,12905,19557,13415,14196,13673,19499,13416,30324,13929,19535,13410,28277,13673,19573,13419,14196,13161,19557,13422,29301,13161,19557,13423,29300,13929,19573,13416,18549,13161,19535,13414,18549,13929,19535,13419,20597,13161,19573,13421,26229,13161,19557,13421,20597,13929,19557,13421,29300,13673,19499,13419,20597,13929,19557,13420,28276,13929,19535,13409,17525,13673,19535,13416,29301,13417,19557,13425,29301,12905,19499,13423,21621,13161,19535,13422,29300,13673,19499,13424,26229,13417,19573,13417,12148,12905,19499,13417,28277,13673,19573,13414,28276,13929,19557,13416,13172,13417,19557,13409,25205,13417,19557,13413,14196,12905,19573,13411,31348,13673,19535,13423,25205,13673,19499,13410,26229,13929,19557,13421,28277,12905,19557,13425,22645,13673,19573,13415,31348,13673,19557,13421,19573,13417,19557,13424,30324,13929,19573,13417,19573,13673,19573,13419,27253,13929,19535,13421,19573,13673,19573,13421,25205,13673,19535,13424,22645,13417,19499,13414,17525,12905,19573,13422,20597,12905,19573,13423,18549,13417,19573,13420,21621,13417,19499,13421,20597,13673,19573,13419,14196,12905,19557,13419,12148,13161,19557,13402,18549,13929,19573,13410,28276,13417,19535,13412,13172,13929,19557,13410,19573,13417,19557,13410,17525,12905,19573,13415,30324,13417,19499,13423,22645,12905,19573,13412,28277,13161,19557,13412,29301,13929,19557,13402,30324,13417,19557,13419,13172,13161,19499,13414,14196,13929,19557,13409,22645,13417,19499,13419,21621,13161,19535,13418,20597,12905,19499,13410,21621,13161,19535,13420,31348,12905,19499,13416,25205,13673,19535,13410,25205,13417,19573,13421,27253,12905,19573,13416,13172,12905,19499,13416,18549,13161,19557,13411,25205,12905,19573,13410,14196,13417,19535,13425,13172,12905,19573,13423,22645,13161,19499,13410,30324,13161,19573,13422,14196,13929,19557,13414,31348,13417,19557,13420,13172,13417,19573,13415,12148,13929,19535,13417,31348,13161,19499,13409,30324,12905,19499,13423,29301,13929,19535,13409,20597,13929,19535,13421,18549,13417,19499,13418,13172,12905,19573,13411,21621,13673,19557,13421,22645,13929,19557,13412,30324,13161,19573,13421,18549,13417,19499,13417,22645,13929,19573,13418,18549,12905,19557,13420,26229,13417,19499,13411,13172,13161,19535,13415,22645,13673,19573,13402,20597,13673,19557,13424,29300,13929,19573,13416,13172,13673,19557,13410,25205,13417,19557,13415,27253,13929,19573,13422,30324,13417,19557,13413,19573,13929,19535,13423,31348,12905,19557,13417,27253,13417,19535,13417,29301,13417,19535,13418,12148,13929,19573,13411,31348,13417,19573,13419,26229,13417,19535,13418,29300,13417,19557,13413,18549,13673,19557,13417,13172,13929,19573,13419,12148,12905,19573,13419,29300,13161,19535,13424,30324,13417,19557,13420,17525,13161,19535,13417,28277,13161,19557,13412,20597,13417,19535,13417,13172,13673,19557,13415,13172,13161,19573,13409,22645,13417,19557,13414,20597,13673,19557,13413,29301,13673,19535,13416,27253,13673,19535,13414,28277,13161,19557,13422,13172,12905,19557,13410,28277,13417,19535,13412,29300,12905,19499,13412,29300,13929,19535,13413,28276,13929,19573,13413,13172,12905,19499,13421,20597,13161,19499,13420,19573,13417,19499,13421,12148,13417,19535,13417,29300,12905,19573,13419,27253,13673,19535,13411,25205,12905,19557,13419,14196,13161,19573,13423,27253,13673,19557,13414,30324,13417,19573,13422,28276,13929,19573,13419,31348,13673,19557,13416,21621,13161,19499,13423,29300,13673,19557,13416,12148,13417,19499,13409,21621,13929,19557,13409,21621,13161,19535,13412,30324,13161,19557,13425,21621,13929,19557,13423,27253,13673,19557,13420,17525,13417,19535,13409,28277,13161,19499,13415,28277,13929,19557,13414,30324,13161,19557,13414,14196,13673,19557,13413,31348,13929,19557,13420,26229,13161,19557,13420,13172,13417,19573,13414,20597,13929,19535,13421,21621,13417,19573,13421,21621,13673,19573,13419,31348,13673,19557,13413,17525,13417,19557,13412,21621,13673,19573,13402,22645,13417,19557,13424,27253,13929,19535,13418,22645,13417,19557,13425,30324,12905,19557,13416,29301,12905,19499,13424,22645,13161,19573,13417,21621,13161,19573,13415,20597,13417,19573,13416,22645,12905,19573,13402,28276,13673,19573,13416,18549,13161,19535,13416,22645,13417,19573,13402,17525,13673,19557,13425,30324,13929,19557,13409,26229,13417,19557,13421,31348,13161,19535,13417,12148,13673,19557,13411,22645,13929,19573,13416,20597,12905,19573,13425,17525,13161,19535,13421,20597,13673,19535,13419,18549,13673,19535,13422,29301,13161,19557,13418,27253,13161,19573,13417,18549,13417,19557,13413,14196,13673,19573,13402,22645,13417,19557,13423,17525,13417,19499,13409,13172,13673,19573,13411,27252,12905,19557,13415,27252,13929,19557,13416,31348,13417,19573,13412,12148,13161,19557,13421,27253,12905,19499,13423,27253,13417,19535,13413,19573,12905,19499,13415,29300,13161,19557,13412,28277,13673,19535,13418,26229,12905,19573,13401,18549,12905,19499,13422,20597,13929,19557,13410,29300,13673,19499,13413,28276,13161,19535,13423,27252,13673,19499,13415,30324,13673,19557,13412,27253,13417,19535,13409,21621,13417,19499,13416,21621,13673,19573,13420,29300,12905,19535,13410,25205,13161,19557,13414,30324,13673,19573,13402,26229,13161,19535,13409,21621,13673,19557,13415,26228,13417,19535,13421,17525,12905,19535,13412,21621,13673,19535,13421,31348,13673,19499,13416,22645,13673,19557,13414,30324,13673,19573,13402,13172,13673,19499,13420,27252,12905,19573,13422,12148,13673,19557,13400,21620,12393,19573,13399,17524,12393,19557,13409,27252,12905,19557,13392,27252,12393,19535,13402,20596,12393,19557,13393,18548,12393,19499,13394,28276,31337,19499,13386,19572,12393,19573,13391,26227,31337,19535,13397,17524,12393,19499,13385,20596,30569,19573,13382,22643,30825,19573,13383,21619,30313,19499,13386,29299,30313,19317,13367,14194,30569,19573,13379,31346,30825,19301,13355,31346,30313,19317,13368,27250,30057,19279,13360,30321,30057,19279,13360,28273,29033,19279,13434,20594,29545,19243,13430,14193,29033,19317,13414,20593,28009,19317,13423,21617,28777,19301,13402,31344,27241,19243,13392,31344,27241,19317,13385,20592,27241,19243,13386,21615,26473,19023,13359,22639,26473,19023,13355,20591,25705,18987,13368,14190,25449,19045,13369,28270,25961,19023,13423,26221,24937,19023,13429,22637,24937,19061,13422,18541,22889,19023,13414,21612,22633,19023,13397,13163,21097,18987,13389,30315,21097,19045,13381,18539,20841,19061,13381,14186,20073,18767,13433,26218,19817,18731,13360,26217,18537,18805,13424,17513,19049,18767,13397,19561,18281,18805,13409,30311,17257,18767,13393,28263,17001,18731,13377,31350,14696,18475,13365,13158,14440,18549,13424,22629,13672,18511,13429,21605,13160,18475,13409,27236,12904,18511,13390,19556,12392,18475,13382,19556,30568,18533,13383,22626,30824,18255,13432,22626,29544,18255,13428,12129,28776,18293,13414,26209,28776,18219,13394,26202,27496,18277,13384,21594,27496,18293,13377,26201,25960,18277,13379,17497,26216,18021,13428,19544,24936,17963,13413,25175,22888,18021,13402,26198,22120,17999,13387,12117,21096,17999,13377,13140,20328,17999,13381,28244,19560,17707,13434,31315,19304,17781,13417,27218,18792,17781,13393,28241,17768,17707,13395,19538,12136,17525,13363,22593,14440,17509,13426,28240,14695,17487,13434,19535,14183,17525,13421,19535,12391,17451,13395,27214,12647,17253,13359,31309,30567,17525,13379,21580,29287,17231,13366,22603,28775,17195,13416,31307,28519,17253,13417,30281,28007,17231,13381,17482,26983,17269,13377,28232,26727,16975,13432,12103,25447,17013,13428,17479,22887,17013,13414,27207,22887,16975,13395,25157,21351,16939,13398,31300,20583,16719,13361,18500,20327,16683,13425,27203,19815,16757,13430,30275,19303,16683,13399,17474,17767,16757,13391,26178,16743,16757,13391,30288,16998,17509,13178,22647,11111,14436,13378,28239,13670,12110,13175,25131,12902,12089,13162,28203,13670,12110,13136,13113,12902,12089,13133,21561,31078,12132,13135,27191,29542,11086,13172,22583,29798,11086,13178,25142,28262,11108,13153,26165,27750,11124,13159,31285,28518,11108,13146,27189,26470,11065,13134,30259,27238,11086,13121,28211,26214,14649,13109,29234,25958,14670,13111,27187,22886,14670,13161,31282,24934,14708,13156,20530,22886,14708,13145,19506,21606,14649,13156,27184,22118,14452,13112,29232,20838,14670,13136,30256,20326,14692,13129,28282,19302,14452,13113,31354,20326,14436,13106,30329,20070,14414,13164,26233,18790,14414,13170,25209,18278,14452,13166,18553,17766,14452,13138,30327,18278,14393,13125,22647,18022,14436,13138,30327,17510,14436,13137,14127,16997,12132,13107,13174,14437,14158,13104,21607,14438,14196,13166,18550,11109,14137,13112,17526,13669,14158,13106,31348,13669,14158,13178,28276,13669,14158,13160,22644,13925,14196,13137,17525,13413,14180,13146,20597,12389,14196,13135,27251,31333,14180,13128,14196,30821,14180,13129,22643,30565,14180,13127,13171,12645,13902,13112,22644,30565,14137,13127,21619,31077,14180,13130,31346,30053,14158,13122,29299,30565,13924,13107,31346,29797,14196,13126,20594,30821,13940,13108,20595,29029,13881,13169,17523,29541,13881,13108,14194,30053,13902,13165,22642,30309,13902,13168,20594,29541,13902,13104,29297,28517,13881,13171,31345,28517,13902,13109,19570,29029,13881,13156,14193,28261,13924,13171,31337,17249,15735,23869,15965,11];

function getRandomNum(min, max) {
      return Math.random() * (max - min) + min;
}

function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min)) + min;
}

function generateMeasurements(numOfMeas, freqStep) {
    var m = [];
    for(var i = 0; i < numOfMeas; i++) {
        var entries = [];
        var freq = freqMin;
        for (var j = 0; j < powers.length; j+=freqStep) {
            entries.push([freq, powers[j]]);
            freq+=freqStep;
        }

        m.push([new Date(), entries]); 
    }

    return m;
}

function getColor2(power) {
	var r, g, b = 0;
    var perc = (power / powerMax) * 100;
    var factor = 7.72 * perc;
	if(perc < 33) {
	    b = 255;
		g = Math.round(factor);
	}
	else if (perc < 66) {
		g = 255;
		b = Math.round(510 - factor);
        r = Math.round(-255 + factor);
	} else {
        r = 255;
        g = Math.round(772 - factor);
    }

    return [r,g,b];
}

function getColorGauss(power, offset) {
    var max = 255;
    var c = (powerMax - powerMin) / 5;
    var center = powerMin + offset;

    var top = Math.pow(power - center, 2);
    var bot = Math.pow(2 * c, 2);
    var exp = -1 * (top / bot);
    var bell = Math.pow(Math.E, exp);
    var color = max * bell;
    return color;
}

function getColor3(power) {
    var r = getColorGauss(power, powerMax);
    var g = 0;//getColorGauss(power, (powerMax * 0));
    var b = getColorGauss(power, (powerMax * 0.5));
    return [r,g,b];
}

function scaleNumber(value, min, max, newMin, newMax) {
    var oldRange = (max - min);  
    var newRange = (newMax - newMin);  
    return (((value - min) * newRange) / oldRange) + newMin;
}

function scaleFreq(value) {
    return Math.round(scaleNumber(value, freqMin, freqMax, 0, width));
}

function getIndex(x, y) {
    return (y * (width * 4)) + (x * 4);
}

function getColor(value) {
    var colorIndex = Math.round(scaleNumber(value, powerMin, powerMax, 0, colors.length-1));
    return colors[colorIndex];
}

function setColors(freq, power, endFreq, imgData, row) {
    var c = getColor3(power);

    var startX = scaleFreq(freq);
    var ymax = row + step;
    var endX = null;

    if (endFreq != null) {
        endX = scaleFreq(endFreq);
    } else {
        endX = width;
    }

    if (ymax > height) {
        ymax -= (ymax - height);
    }

    for(var x = startX; x < endX; x++) {        
        for(var y = row; y < ymax; y++) {
            var rindex = getIndex(x, y);
            imgData[rindex] = c[0];
            imgData[rindex + 1] = c[1];
            imgData[rindex + 2] = c[2];
            imgData[rindex + 3] = 255;
        }
    }
}

function addPower(power, startIndex, stopIndex) {
    for(var i = startIndex; i < stopIndex; i++) {
        powers[i] = Math.min(powerMax, powers[i] + power);
    }
}

$(document).ready(function() {
    var ctx = $('#canvas')[0].getContext('2d');
    var ctx2 = $('#canvas2')[0].getContext('2d');
    var imgData = ctx.createImageData(width, height);
    var imgData2 = ctx.createImageData(50, 2943);

    powerMin = 0;
    powerMax = 0;
    for (var i = 0; i < powers.length; i++) {
        if (powers[i] < powerMin) {
            powerMin = powers[i];
        }

        if (powerMax < powers[i]) {
            powerMax = powers[i];
        }
    }
  
    addPower(10000, 1200, 1800);
    var measurements = generateMeasurements(5000, 5);
    
    var pwr = powerMin;
    for(var i = 0; i < imgData2.data.length; i+=4) {
        var c = getColor3(pwr);
        imgData2.data[i] = c[0];
        imgData2.data[i+1] = c[1];
        imgData2.data[i+2] = c[2];
        imgData2.data[i+3] = 255;
        pwr++;
    }


    for (var i = 0; i < measurements.length; i++) {
        var entries = measurements[i][1];
        for (var j = 0; j < entries.length; j++) {
            var freq = entries[j][0];
            var power = entries[j][1];
            var nextFreq = null;

            if ((j + 1) < entries.length) {
                nextFreq = entries[j+1][0];
            }

            setColors(freq, power, nextFreq, imgData.data, (i*step));
        }
    }
    
    /*for(var i = 0; i < imgData.data.length; i+=4) {
        imgData.data[i] = 255;
        imgData.data[i+1] = 0;
        imgData.data[i+2] = 0;
        imgData.data[i+3] = 255;
    }*/

    ctx2.putImageData(imgData2, 0, 0);
    ctx.putImageData(imgData, 0, 0);
});
